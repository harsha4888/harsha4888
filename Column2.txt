Quarter1 = 
IF(
    [date_filtered] = 0,
    YEAR('Viz Expenses'[Created Date]) & "Q" & QUARTER('Viz Expenses'[Created Date]),
    IF(
        [date_filtered] = 1,
        YEAR('Viz Expenses'[Payment Date]) & "Q" & QUARTER('Viz Expenses'[Payment Date]),
        YEAR('Viz Expenses'[Transaction Date]) & "Q" & QUARTER('Viz Expenses'[Transaction Date])
    )
)

Current or Last Quarter = 
VAR CurrentYear = YEAR(TODAY())
VAR CurrentQuarter = QUARTER(TODAY())
VAR MaxQuarter = CurrentYear * 10 + CurrentQuarter  -- Encode as YYYYQ format
VAR LastQuarter = IF(CurrentQuarter = 1, (CurrentYear - 1) * 10 + 4, CurrentYear * 10 + CurrentQuarter - 1)
VAR YearPart = VALUE(LEFT('Viz Expenses'[Quarter1], 4))  -- Extract the year
VAR QuarterPart = VALUE(RIGHT('Viz Expenses'[Quarter1], 1))  -- Extract the quarter number
VAR QuartEncoded = YearPart * 10 + QuarterPart  -- Encode in YYYYQ format
RETURN
    IF(
        QuartEncoded = MaxQuarter, 
        "Current Quarter",
        IF(
            QuartEncoded = LastQuarter, 
            "Last Quarter", 
            BLANK()
        )
    )


Current or Last Quarter = 
VAR CurrentYear = YEAR(TODAY())
VAR CurrentQuarter = QUARTER(TODAY())
VAR MaxQuarter = CurrentYear * 10 + CurrentQuarter  -- Encode as YYYYQ format
VAR LastQuarter = IF(CurrentQuarter = 1, (CurrentYear - 1) * 10 + 4, CurrentYear * 10 + CurrentQuarter - 1)
VAR QuartEncoded = VALUE(LEFT('Viz Expenses'[Quarter1], 4)) * 10 + VALUE(RIGHT('Viz Expenses'[Quarter1], 1))
RETURN
    IF(
        QuartEncoded = MaxQuarter, 
        "Current Quarter",
        IF(
            QuartEncoded = LastQuarter, 
            "Last Quarter", 
            BLANK()
        )
    )



Current or Last Quarter Rank = 
SWITCH(
    TRUE(),
    'Viz Expenses'[Current or Last Quarter] = "Current Quarter", 1,
    'Viz Expenses'[Current or Last Quarter] = "Last Quarter", 2,
    BLANK()
)

